<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="keywords" content="个人开发学习" />
  <meta name="description" content="个人开发学习" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>个人开发学习</title>
  <script src="/lib/layui/layui.js" charset="utf-8"></script>
  <!--<script src="./layui/layui.js"></script>-->
  <script src='./js/libs/jquery.js'></script>

  <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon" />
  <!-- 公共样式CSS -->
  <link rel="stylesheet" href="./css/common.css">
  <!-- 登录样式 -->
  <link rel="stylesheet" href="./css/login.css">
</head>

<body>
  <!-- 头部  公共的 -->
  <header id="header">
    <!-- 头,顶部 start -->
    <div class="header">
      <div class="center">
        <div class="left">
          <a href="#">
            欢迎来到我的个人开发网站
          </a>
        </div>
        <div class="right">
          <ul>
            <li id="isLogin"> </li>
            <li> <a href="cart.html">我的购物车</a></li>
          <!--  <li> <a href="#">会员</a></li>
            <li> <a href="#">甄选家</a></li>
            <li> <a href="#" class="iconfont">企业采购 &#xe61b</a></li>
            <li> <a href="#" class="iconfont">客户服务 &#xe61b</a></li>-->
            <li> <a href="#" class="iconfont">&#xe612 我的</a></li>
          </ul>
        </div>
      </div>
    </div>
    <!-- 头,顶部 end -->

    <!-- 头, 搜索区域 start -->
    <div class="search">
      <div class="center">
        <div class="logo">
          <a href="index.html">logo</a>
        </div>
        <div class="search-btn">
          <div class="top">
            <input type="text" autocomplete="off" maxlength="100">
            <span>搜索</span>
            <i></i>
          </div>
          <div class="bottom">

          </div>
        </div>
        <a class="cart" href="./cart.html">
          <i class="gwc"></i>
          <span class="text">购物车</span>
          <!-- <i class="circle">0</i> -->
        </a>
      </div>
    </div>
    <!-- 头, 搜索区域 end -->

    <!-- 头, nav区域 start-->
    <ul class="nav center">
      <li><a href="index.html" class="current">首页</a></li>
<!--      <li><a href="#">居家生活</a></li>
      <li><a href="#">服饰鞋包</a></li>
      <li><a href="#">美食酒水</a></li>
      <li><a href="#">个护清洁</a></li>
      <li><a href="#">母婴亲子</a></li>
      <li><a href="#">运动旅行</a></li>
      <li><a href="#">数码家电</a></li>
      <li><a href="#">严选全球</a></li>
      <li><a href="#">为你推荐</a></li>
      <li><a href="#">众筹</a></li>-->
    </ul>
    <!-- 头, nav区域 end-->
  </header>


  <!-- login -->
  <div class="login">
    <div class="bg">
      <div class="g-row center">
        <div class="login-post" id="login_register">
          <!--显示头部-->
          <div class="login-header">
            <span id="login">登录</span>
            <strong>|</strong>
            <span id="register">注册</span>
          </div>
          <form>
            <div class="inputbox">
              <div class="logo">
                <img src="./images/phone.png" alt="">
              </div>
              <input type="text" placeholder="请输入账号" autocomplete="off" maxlength="11" id="phone"  name="phone">
              <span class="phoneMsg"></span>
            </div>
           
            <div class="inputbox">
              <div class="logo">
                <img src="./images/phone.png" alt="">
              </div>
              <input type="password" placeholder="请输入密码" autocomplete="off" id="pwd" name="pwd">
              <span class="pwdMsg"></span>
            </div>
        
            <div class="btn"><!--type="button"  onclick="login()"-->
              <button type="button" id="submit" onclick="loginOrregister()">登录</button>
            </div>
          </form>
          <div class="yx-loginFooter">
            <div class="oList">
            <!--  <a href="#"></a>
              <a href="#"></a>
              <a href="#"></a>
              <a href="#"></a>-->
            </div>
            <span>遇到问题?</span>
          </div>

          <div class="lg-ewm">
            <img src="./images/login_ewm.png" alt="">
          </div>
          <div class="lg-sm">
            <img src="./images/login_sm.png" alt="">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 底部 -->
  <footer>
    <div class="center">
      <div class="yx-cp-m-ft1">
        <div class="yx-cp-item">
          <h4></h4>
          <div class="btn">
            <a href="#">
              <i></i>
              <span></span>
            </a>
            <a href="#">
              <i></i>
              <span></span>
            </a>
          </div>
        </div>
        <div class="yx-cp-item" >
          <h4 style="background-color: #eb7350;">个人学习开发网站</h4>
          <p>
            该网站用于测试开发产品，不用于商业用途,欢迎同行来访，共同学习
          </p>
          <div class="ewm" style="text-align: center;background-color: #93D1FF;">
            &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#b2b2b2;size: 30pt;background-color: white;">赣ICP备2021011648号-1</a>

          </div>
        </div>
        <div class="yx-cp-item">

        </div>
      </div>
      <!-- 还有一个底部,不打算做了,没意义. 为什么提交不了-->
      <div class="yx-cp-m-ft2"></div>
    </div>
  </footer>

  <script src="./js/login.js"></script>
  <script src="./js/common.js"></script>

</body>

<script>

  layui.use(['jquery','layer'],function() {
    $ = layui.jquery
            , layer = layui.layer

  });

  function loginOrregister() {
    console.log("执行登录方法")
    var myreg = /^[1][3,4,5,7,8,9][0-9]{9}$/;
    var name=document.getElementById("submit").innerHTML;
    console.log("按钮名："+name);
    let url='/login';
    if (name=="注册"){
      url='/register';
      var phone=$("#phone").val();
      var pwd=$("#pwd").val();
      if(phone==""||phone==null){
           layer.msg("账号不能为空！");
           return
      }if(!myreg.test(phone)){
        layer.msg("手机号格式不正确");
        return;
      }
      if(pwd==""||pwd==null){
        layer.msg("密码不能为空!");
        return;
      }if(pwd.length<6||pwd.length>16){
        layer.msg("密码长度不合格，请输入6到16位以内的密码！")
        return;
      }
      else {
        console.log("注册表单",$('form').serialize());
        $.ajax({
          url:url,
          data:$('form').serialize(),
          success:function (res) {
            if (res=="register"){
              layer.msg('注册成功', { icon: 1, time: 1000, shade: 0.4 },function f() {
                location.replace('login.html');
              });
            }
            else {
              layer.msg('注册失败', { icon: 2, time: 1000, shade: 0.4 });
            }
          }
        })
      }
    }
    else {
      console.log(url);
      var myreg = /^[1][3,4,5,7,8,9][0-9]{9}$/;
      var phone=$("#phone").val();
      var pwd=$("#pwd").val();
      if(phone==""||phone==null){
        layer.msg("账号不能为空！");
        return
      }if(!myreg.test(phone)){
        layer.msg("手机号格式不正确");
        return;
      }
      if(pwd==""||pwd==null){
        layer.msg("密码不能为空");
        return;
      }if(pwd.length<6||pwd.length>16){
        layer.msg("密码长度不合格，请输入6到16位以内的密码！")
        return;
      }
      else {
        console.log("登录表单",$('form').serialize());
        $.ajax({
          url:url,
          //type: 'POST',
          data: $('form').serialize(),
          success:function (res) {
            if (res=="login"){
              console.log("登录成功，弹出窗口");
              var username=null;
              layer.msg('登录成功', { icon: 1, time: 1000, shade: 0.4 },function loaduser(ress) {
                $.post('/getUserByUno',function (data) {
                  console.log("得到当前对象的名字"+data.uname);
                  username=data.uname;
                  console.log("得到username的值"+username);
                  //登录的数据存放到sessionStorage中
                  sessionStorage.setItem('User', JSON.stringify(username));
                  var users=JSON.parse(sessionStorage.getItem('User'));
                  console.log(users);
                  //console.log(sessionStorage.getItem('User'));
                  //location.replace('/index.html');
                  location.href="/index.html";
                });

              });
              //layer.msg("登录成功");
              //location.replace('index.html');
            }
            else {
              layer.msg('登录失败，用户名或密码错误', { icon: 2, time: 1000, shade: 0.4 });
              //layer.alert("登录失败，用户名或密码错误");
              //layer.msg("登录失败");
            }
          }
        })
      }

    }
  }



</script>



</html>